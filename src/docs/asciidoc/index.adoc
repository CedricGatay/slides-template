:encoding: UTF-8
:author: Cedric Gatay
:keywords: @Cedric_Gatay
:email: contact@code-troopers.com
:source-highlighter: prettify
:imagesdir: ./images
:icons: font
:title: Tour d'horizon de Java EE
:iconfont-cdn: https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.0/css/font-awesome.min.css

[#title]
== {title}
[.canvas]
image::rick-mason-532835-unsplash.jpg[]
[.credit]
https://unsplash.com/photos/2FaCKyEEtis

[.author]
--
{author} - {localdate}
--

== Agenda
 * Java vs Java EE
 * Concepts
 * Spécifications
      ** Java Persistence API
      ** Enterprise Java Bean
      ** CDI
      ** Servlet / Filter
      ** Java Server Pages / Java Server Faces
      ** Webservices

== ! Forewords
[.canvas]
image::me_you.gif[]


== ! Cedric Gatay

icon:twitter[] @Cedric_Gatay

icon:code[] Developer

image:ct-square.png[role=small ct] Code-Troopers co-founder

icon:google[] GDG Tours lead

image:tnt_logo.png[role=small] TouraineTech co-organizer

[.cue]
****
Je fais partie des co-fondateurs de Code-Troopers, des leads du Google Developer Group de Tours et co-organisateur de Touraine Tech.
****


== ! icon:code-fork[]

 * icon:bus[] http://navigtours.com[Navig'Tours] icon:apple[] icon:android[]
 * icon:music[] http://chapi.to[Chapi.to] icon:apple[] icon:android[]
 * icon:github[] FOSS:
 ** icon:calendar[] Android Betterpickers icon:android[]
 ** icon:github-alt[] sbt plugins icon:globe[]
 ** icon:github-alt[] wicket-hot-reload icon:globe[]
 ** icon:gitlab[] Gitlab icon:globe[]

[.cue]
****
Je fais aussi des apps web, mobiles, et de l'open source sur quelques projets
****


== ! Disclaimer

[.two-columns]
--
[.left-content centered white]
[[JavaEE7Packt]]
image::1496_6640EN_Java%20EE%207%20Web%20Application%20Development.jpg[]

[.right-content]

 * JavaEE est très vaste
 * JavaEE7 @ PacktPub : 496 pages
-> 2H de CM / 6H de TP

--

[canvas-image="images/home.jpg"]
== ! Java vs JavaEE
[.canvas]
image::home.jpg[]


== Contexte

Java

 * langage objet
 * v1.0 en 1995 / 10 en 2018
 * ≠ Javascript


== ! Flashback
[.canvas]
image::flashback.png[]

== Flashback

1996, internet balbutiant, cible applications lourdes

Concurrence des MFC / C++

Promesse du Write Once Run Anywhere

  * machine virtuelle
  * "assembleur universel"


== Java
//This can be long, maybe introduce codenames with pictures to ease flow
[.timeline]
image::javase_timeline.png[]

 * Java 1.0 : 1996
    ** initial version
    ** stable 1.0.2
    ** originellement nommé Oak

== !
[.timeline]
image::javase_timeline_2.png[]

 * Java 1.1 : 1997
    ** JavaBeans
    ** JDBC
    ** Reflection (Read-only)
    ** Inner classes
    ** JIT (on Windows)

== !
[.timeline]
image::javase_timeline_3.png[]

 * J2SE 1.2 : 1998
    ** 1520 classes (taille triplée)
    ** Swing
    ** Collections
    ** JIT everywhere

== !
[.timeline]
image::javase_timeline_4.png[]

 * J2SE 1.3 : 2000
    ** JNDI
    ** JPDA
    ** JavaSound

== !
[.timeline]
image::javase_timeline_5.png[]

 * J2SE 1.4 : 2002
    ** Regex
    ** Exception chaining
    ** NIO
    ** JAXP
    ** Java WebStart

== !
[.timeline]
image::javase_timeline_6.png[]

 * J2SE 5.0 : 2004
    ** Generics
    ** Annotations
    ** enum
    ** static imports
    ** `java.util.concurrent`

== !
[.timeline]
image::javase_timeline_7.png[]

 * Java SE 6 : 2006
    ** Performances
    ** Scripting
    ** JAX-WS

== !
[.timeline]
image::javase_timeline_8.png[]

 * Java SE 7 : 2011
    ** Invokedynamic
    ** try with resources
    ** NIO 2
    ** Concurrency utilities

== !
[.timeline]
image::javase_timeline_9.png[]

 * Java SE 8 : 2014
    ** Lambda
    ** Date and time API
    ** Overhauled annotations

== !
[.timeline]
image::javase_timeline_10.png[]

 * Java SE 9 : 2017
    ** Java Modules
    ** Java REPL

== !
[.timeline]
image:javase_timeline_11.png[]

 * Java SE 10 : 2018 
    ** Local-variable type inference
    ** Time-based releases
    ** Parallel Full GC

== JavaEE

 * Java SE + des APIS "entreprise"
 * cycle de release indépendant

== Versions
[.two-columns]
--
[.left-content]
[[ee-roadmap]]
image::ee-roadmap-8.png[]

[.right-content]
 * 1999 : J2EE 1.2 (10 specs)
 * 2001 : J2EE 1.3 (13 specs)
 * 2003 : J2EE 1.4 (20 specs)
 * 2006 : JavaEE 5 (23 specs)
 * 2009 : JavaEE 6 (28 specs)
 * 2013 : JavaEE 7 (31 specs)
 * 2017 : JavaEE 8 (12 specs)
--

== Version entreprise

Applications visant à être

[%build]
* complexes
* fiables
* interconnectées
* sécurisées

== !

 * conçu pour répondre à la montée d'internet
 * rationaliser les développements
  ** maîtrise des coûts
  ** **D**on't **R**epeat **Y**ourself

== Concepts

 * philosophie n-tiers
 * meta programmation par annotations
 * convention over configuration
 * système de normalisation "ouvert"

== Architecture n-tiers

 * applications d'envergures
 * équipes multiples
 * responsabilités partagées
 * modèle de conception

== !

[.two-columns]
--

 * MVC
 ** Model
 ** View
 ** Controller

[[mvc-chart]]
image::mvc-diagram.png[role=left-content white centered]

--

== !

[.two-columns]
--


 * Mobile/Rich client
 ** REST endpoints
 ** Model
 ** Controller

[[mvc-mobile]]
image::mvc-mobile.png[role=left-content white centered]

--

== Méta-programmation

[%build]
--

[%build]
 * Besoin d'ajouter des informations au code
 * Utilisation intensive de XML (pre Java EE 6)
 * Configuration par annotations (Java EE 6)

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/MyServlet.java[tags=annot]
-----

--

== Convention over configuration

[%build]
--
 * à l'utilisation des _patterns_ sont apparus
 * simplification de l'utilisation en les adoptant par défaut
 * possibilité de redéfinition manuelle

[%build]
-> Rassurez-vous il reste du XML

[%build]
image::trollface.jpg[width=300px,role="center"]
--

== Process de normalisation

[%build]
 * Ecriture d'une **J**ava **S**pecification **R**equest
 * Fourniture du **T**oolkit **C**ompatibility **K**it
 * Ecriture d'une **R**eference **I**mplementation

== Cycle de travail

[%build]
 * Implémentation
 * Compilation
 * Packaging
 * Déploiement

== Implémentation

IDE Java

 * Netbeans
 * Eclipse
 * IntelliJ Idea
 * vim / emacs...

== Compilation

Outils spécialisés

 * Make
 * ant
 * Maven
 * Gradle
 * SBT

== Packaging

 * format d'archives en *AR
   ** WAR : **W**eb **AR**chive
   ** JAR : **J**ava **AR**chive
   ** EAR : **E**nterprise **AR**chive

 * Exécution gérée par le serveur d'application


== Serveurs d'application

[%build]
 * exécute le code métier
 * fournit des services
[%build]
 ** gestion des transactions
 ** gestion des sources de données
 ** mise en place de cluster
 ** remontée d'informations
 ** gestion des logs
 ** gestion des utilisateurs

== ! Show me the code
[.canvas]
image::showcode.gif[]

== Stockage des données

*Comment passer du monde relationnel au monde objet ?*

 * **O**bject **R**elational **M**apper
 * Association entre objets et tables

-> facilité d'utilisation et portabilité

== !

*Java Persistence API*

 * __ORM__
 * Gestion des transactions (**J**ava **T**ransaction **A**PI)
 * Langage de requêtage spécifique (**J**ava **P**ersistence **Q**uery **L**anguage)
 * Agnostique du SGBD

== !

// etoffer avec un exemple ´a l'ancienne'
[source,java]
-----
//acquire a connection to your DB in connection var
Statement stmt = connection.createStatement();
ResultSet rs = stmt.executeQuery("SELECT name,email FROM users;");
while(rs.next()){
	 user = new User(
		rs.getString("name"), 
		rs.getString("email")
	 );
	// do what you want with your user object
}
rs.close();
//need to nest into try/catch/finally and close connection too
-----

== !


[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/domain/entities/User.java[tags=class]
-----
<1> Définition en tant qu'entité
<2> Contraintes sur la table (nom...)
<3> Définition du champ clef primaire
<4> Contraintes sur les champs


== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/domain/UserDAO.java[tags=allMethod]
-----

[.book-canvas]
== CDI
[.canvas]
image::blackbook.gif[]

== Dépendances entre composants

 * le découpage en tiers introduit des dépendances

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/services/UserServiceNoIoC.java[tags=class]
-----

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/services/UserServiceNoIoC.java[tags=ctor]
-----

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/UserServletNoIoC.java[tags=class]
-----


== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/UserServletNoIoC.java[tags=ctor]
-----

== !
 
*Problèmes*
 
 * enchaînement des `new`
    ** création pas toujours triviale des dépendances
    ** `boilerplate` de création d'objet à gérer
 * aucun recyclage des objets

-> beaucoup de code inutile

== !

*Inversion Of Control*

 * **C**ontext and **D**ependency **I**njection
 * mécanisme d'IoC, central à JavaEE
 * définition d'un `scope`, de l'association à des services
 * déclaration des dépendances
 * le serveur d'application fait le reste

== ! Hollywood principle ==
[.canvas]
image::hollywood.jpg[]
// [.canvas-caption,center top]
// "Don't call us, we'll call you !"

== ! Context and Dependency Injection


[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/services/UserService.java[tags=class]
-----
<1> Injection d'un UserDAO


== !


[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/UserServlet.java[tags=class]
-----
<1> Injection du UserService


== !

 * `@Inject` demande l'injection
 * `@Produces` permet de mettre un objet dans le cycle d'injection

== ! 

*Notion de `scope`*
 
 * Cycles de vies différents selon l'utilisation
 ** `@ApplicationScoped` vit toute l'application
 ** `@SessionScoped` vit toute la session utilisateur
 ** `@RequestScoped` vit la durée de la requête utilisateur

[.book-canvas]
== EJB
[.canvas]
image::blackbook.gif[]

== Enterprise Java Bean

 * encapsule la logique métier
 * cycle de vie automatique
 * trois types principaux
  ** sans état
  ** avec état
  ** singletons

== Sans état

 * annotation `@Stateless`
 * objets pouvant être réutilisés -> Thread Safe
 * peut être partagé par plusieurs utilisateurs

*Exemple* : récupération des promotions du jour

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/services/UUIDService.java[tags=class]
-----
<1> Bean sans état
<2> Génération d'un identifiant

== Avec état

 * annotation `@Stateful`
 * le container gère l'état et l'associe à un client
 * contient des données propres à l'utilisateur

*Exemple* : panier d'achat e-commerce

== !


[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/services/CartService.java[tags=class]
-----
<1> Bean avec état
<2> attaché à la session utilisateur
<3> contenu du panier par utilisateur


== Singleton

 * annotation `@Singleton`
 * une seule instance partagée
 * doit être le même pour tous les utilisateurs

*Exemple* : compteur de visiteurs

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/domain/VisitBean.java[tags=class]
-----
<1> variable partagée
<2> traces sur la création / destruction
<3> verrous en lecture / écriture


[.book-canvas]
== Servlet
[.canvas]
image::blackbook.gif[]


== Servlet

 * bas niveau
 * très utilisées
 * traite les requêtes HTTP


== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/MyServlet.java[tags=class]
-----

== !

[.get]
link:tpjavaee/[]

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/MyServlet.java[tags=get]
-----

== !

[.post]
link:tpjavaee/[]

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/MyServlet.java[tags=post]
-----

// /!\ JavaEE 7 : appels réactifs possibles `asyncSupported`

[.book-canvas]
== Filter
[.canvas]
image::blackbook.gif[]


== Filter

 * bas niveau
 * très utilisées
//createur de framework
 * "décore" les requêtes HTTP

== !


[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/MyFilter.java[tags=class]
-----
<1> Motif d'URL à prendre en compte
<2> Délégation au filtre suivant


== !

[source,shell]
-----
INFO  [com.codetroopers.eput.MyFilter] Before filtering
INFO  [com.codetroopers.eput.MyFilter] After filtering
-----

[.book-canvas]
== JSP
[.canvas]
image::blackbook.gif[]


== JavaServer Pages

 * ensemble d'outils pour décrire une page HTML
 * écriture de XML
 * la page `.jsp` peut contenir du code
 * de moins en moins utilisé

== !

[.get.blank]
link:tpjavaee/helloWorld.jsp[]

[source,jsp]
-----
include::sample/src/main/webapp/helloWorld.jsp[tags=jsp] 
-----

== !

*Problèmes*

 * du code dans les vues
 * MVC _mélangé_
 * compilé par le serveur d'application

//TODO picture : it works on my machine

//-> "Oups"

[.book-canvas]
== JSF
[.canvas]
image::blackbook.gif[]


== JavaServer Faces

 * écriture orientée composants
 ** réutilisabilité
 ** composition de comportement
 * CDI au coeur du système
 * support des technologies "modernes"


//FIXME too long samples / bad indentation

== !

[source,xml,role=noscale]
-----
include::sample/src/main/webapp/WEB-INF/templates/default.xhtml[tags=full]
-----

== !

[.get.blank]
link:tpjavaee/login.xhtml[]

[source,xml]
-----
include::sample/src/main/webapp/WEB-INF/templates/default.xhtml[tags=sample]
-----

== !

Expression Language

 * `${prop.in.a.bean}` : évaluation immédiate
 * `#{prop.in.a.bean}` : évaluation différée
 * accès à des variables ou méthodes

== !

*Problèmes*

 * du code dans les vues (mais beaucoup moins)
 * fais partie de la spec, pas forcément aussi largement utilisé

[.book-canvas]
== JAX-RS
[.canvas]
image::blackbook.gif[]


== Webservices

 * moyen de communication inter-app principal
 * REST / SOAP
 * assemblage transparent avec les autres services

== !

**S**imple **O**bject **A**ccess **P**rotocol

 * format d'échange XML
 ** objets
 ** méthodes
 * verbeux
 * en train de disparaître

//TODO here comes a new challenger

== !

[.get]
link:tpjavaee/ws/users[]
[.post]
link:tpjavaee/ws/users?name=aeaze&email=\qsd@qsd.fr[]

**RE**presentational **S**tate **T**ransfer

  * façon de penser un webservice
  * utilisation des verbes http
  * pas d'état côté serveur

== !

[source,java]
-----
include::sample/src/main/java/com/codetroopers/eput/ws/UserWebService.java[tags=class]
-----
<1> Base de l'application REST
<2> Chemin de réponse
<3> Type de données créées par le webservice
<4> Verbe HTTP à considérer
<5> Récupération de la valeur des paramètres



== ! Retour à la discussion
[.canvas]
image::end_examples.gif[]


== Pourquoi est-ce populaire ?

Souvent en entreprise :

 * stations de dev Windows
 * serveurs Linux

-> peu d'adhérences à l'os

== !

 * specs publiques, concurrence des serveurs
 * FOSS : culture open source importante
 * marché lucratif


== ! Ecosystème
[.canvas]
image::ecosystem.jpg[]

// [.canvas-caption, position=center-up]
// Ecosystème

== Serveurs d'application

[.image_grid]
--
image::wildfly.png[role="image_slide captioned", title="Wildfly"]
image::glassfish.png[role="image_slide captioned", title="Glassfish"]
image::jbossas.png[role="image_slide captioned", title="JBoss AS"]
image::websphere.jpg[role="image_slide captioned", title="Websphere"]
image::weblogic.png[role="image_slide captioned", title="Weblogic"]
--

== FOSS

[.image_grid.two_per_row]
--
image::github.png[role="image_slide captioned", title="Github"]
image::apache.png[role="image_slide captioned", title="Apache"]
image::eclipse.png[role="image_slide captioned", title="Eclipse"]
//TODO replace by JFROG
image::codehaus.png[role="image_slide captioned", title="Codehaus"]
--


== Projets notables

[.image_grid]
--
image::maven.png[role="image_slide captioned", title="Maven"]
image::jenkins.png[role="image_slide captioned", title="Jenkins"]
image::hibernate.png[role="image_slide captioned", title="Hibernate"]
image::aspectj.png[role="image_slide captioned", title="AspectJ"]
image::jetty.png[role="image_slide captioned", title="Jetty"]
image::tomcat.png[role="image_slide captioned", title="Tomcat"]
--

== "Concurrents"

[.image_grid]
--
image::spring.png[role="image_slide captioned", title="Spring"]
image::play.png[role="image_slide captioned", title="Play! Framework"]
image::grails.png[role="image_slide captioned", title="Grails"]
image::rails.png[role="image_slide captioned", title="Ruby On Rails"]
image::symfony.png[role="image_slide captioned", title="Symfony"]
--

== ! Packaging
[.canvas]
image::michal-parzuchowski-224092-unsplash.jpg[]
[.credit]
https://unsplash.com/photos/geNNFqfvw48

== Packaging

Outils principaux
 
 * Maven
 * Gradle

== ! Structure d'un projet

[source,shell]
----
├── pom.xml <1>
└── src
    └── main <2>
        ├── java <3>
        ├── resources <4>
        └── webapp <5>
    └── test <6>
        └── java <3>
----
<1> Descripteur du projet 
<2> Source de production
<3> Sources Java
<4> Fichiers de ressources
<5> Fichiers web
<6> Sources de tests

== ! Anatomie d'un descripteur de projet

[source,xml]
----
include::sample/pom.xml[tag=project]
----

== ! Dependences

[source,xml]
----
include::sample/pom.xml[tag=dependency]
----

== ! Plugins

[source,xml]
----
include::sample/pom.xml[tag=plugin]
----


== ! Utilisation de maven

[source, shell]
----
mvn clean <1>
mvn package <2>
mvn verify <3>
mvn wildfly:run <4>
----
<1> Supprime les résultats de la compilation
<2> Construit le livrable applicatif
<3> Lance les tests pour valider le livrable
<4> Démarre un `Wildfly` (TP)

== ! Java EE est mort
[.canvas]
image::luiz-hanfilaque-342635-unsplash.jpg[]
[.credit]
https://unsplash.com/photos/7RtM37cLJ3c[]
[.cue]
****
Dans les événements récents autour de l'écosystème JavaEE il y a quelque chose que vous devez quand même savoir.
C'est que Java EE est mort, il n'existe plus, je vous parle de tout plein de choses qui ne sont plus.
Enfin, qui sont utilisées dans des milliers d'applicatifs sur la planète, comme...
****

== Java EE Apps

[.cue]
****

Bon, j'ai peut être aggravé la situation, Java EE est mort, mais il a surtout été transféré d'Oracle à la fondation Eclipse.
Et il a changé de nom...
****

[.white.center]
== ! Welcome Jakarta EE
[.canvas.contain]
image::Jakarta_Drop-smaller.jpg[]
[.cue]
****
Il s'appelle désormais Jakarta EE, on peut l'abréger JEE sans problème.
****



== ! A vous de jouer
[.canvas]
image::yourturn.gif[]


// [.canvas-caption, position=center-up]
// A votre tour !

== TP + CC

 * mini projet à 2
 * base de travail commune à tous
 ** squelette fonctionnel
 ** sujet identique
 ** 1 TP -> 1 ajout fonctionnel
 ** max 1h de travail entre les TPs
 * notation à l'issue de la dernière séance

== Références
[bibliography]

- [[ee-roadmap]] http://blog.eisele.net/2013/06/javaee7-is-final.html
- [[mvc-chart]] https://netbeans.org/kb/docs/javaee/ecommerce/design.html
- [[mvc-mobile]] https://dzone.com/articles/load-data-from-database-using-web-api